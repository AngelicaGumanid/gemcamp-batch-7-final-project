<%= stylesheet_link_tag "table", "data-turbo-track": "reload" %>

<h1>Items</h1>
<%= link_to 'New Item', new_admins_item_path, class: 'btn btn-primary mb-3' %>

<%= form_with url: admins_items_path, method: :get, local: true do %>
  <div class="form-check mb-3">
    <%= check_box_tag 'show_deleted', 'true', params[:show_deleted] == 'true', id: 'show_deleted', class: 'form-check-input' %>
    <%= label_tag 'show_deleted', 'Show Deleted Items', class: 'form-check-label' %>
  </div>
<% end %>

<table class="table table-striped table-bordered">
  <thead>
  <tr>
    <th scope="col">Name</th>
    <th scope="col">Image</th>
    <th scope="col">Quantity</th>
    <th scope="col">Minimum Tickets</th>
    <th scope="col">Batch Count</th>
    <th scope="col">Category</th>
    <th scope="col">Status</th>
    <th scope="col">State</th>
    <th scope="col">State Actions</th>
    <th scope="col">Actions</th>
  </tr>
  </thead>
  <tbody>
  <% @items.each do |item| %>
    <tr>
      <td data-label="Name"><%= item.name %></td>
      <td data-label="Image"><%= image_tag(item.image.url, size: "100x100") if item.image.present? %></td>
      <td data-label="Quantity"><%= item.quantity %></td>
      <td data-label="Minimum Tickets"><%= item.minimum_tickets %></td>
      <td data-label="Batch Count"><%= item.batch_count %></td>
      <td data-label="Category"><%= item.category&.name || 'Uncategorized' %></td>
      <td data-label="Status"><%= item.status %></td>
      <td data-label="State"><%= item.aasm.current_state %></td>
      <td data-label="State Actions">
        <% if item.deleted_at.nil? %>
          <%= button_to raw('<i class="bx bx-play Start"></i> Start'), start_admins_item_path(item), method: :patch, class: 'btn btn-outline-success btn-sm mb-1' if item.may_start? %>
          <%= button_to raw('<i class="bx bx-pause Pause"></i> Pause'), pause_admins_item_path(item), method: :patch, class: 'btn btn-outline-warning btn-sm mb-1' if item.may_pause? %>
          <%= button_to raw('<i class="bx bx-stop Stop"></i> End'), end_admins_item_path(item), method: :patch, class: 'btn btn-outline-danger btn-sm mb-1' if item.may_end? %>
          <%= button_to raw('<i class="bx bx-x Cancel"></i> Cancel'), cancel_admins_item_path(item), method: :patch, class: 'btn btn-outline-secondary btn-sm mb-1' if item.may_cancel? %>
        <% else %>
          <%= button_to raw('<i class="bx bx-revision Restore"></i> Restore'), restore_admins_item_path(item), method: :patch, class: 'btn btn-outline-success btn-sm mb-1' %>
        <% end %>
      </td>
      <td data-label="Actions">
        <%= link_to raw('<i class="bx bx-show Show"></i> Show'), admins_item_path(item), class: 'btn btn-outline-info btn-sm mb-1' %>
        <% if item.deleted_at.nil? %>
          <%= link_to raw('<i class="bx bx-edit Edit"></i> Edit'), edit_admins_item_path(item), class: 'btn btn-outline-warning btn-sm mb-1' %>
          <%= button_to raw('<i class="bx bx-trash Trash"></i> Delete'), admins_item_path(item), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-outline-danger btn-sm mb-1' %>
        <% end %>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>

<div class="d-flex justify-content-center">
  <%= paginate @items %>
</div>
